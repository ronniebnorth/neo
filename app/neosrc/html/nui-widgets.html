<ph-components>
  <template name="nui-icon">
    <style>
      :host {
        font-size: 50pt;
        color: #2f2;
      }
    </style>
    <content></content>
  </template>

  <template name="nui-button">
    <style>
    :host {
      display: inline-block;
      outline: none;
      width:1.5em;
      height:1.5em;
      line-height:1.5em;
      border: 2px solid #f5f5f5;
      border-radius: 50%;
      text-align:center;
      text-decoration:none;
      background: #464646;
      box-shadow: 0 0 3px gray;
      font-weight:bold;
      cursor: pointer;
    }

    span {
      color: #fff;
    }
    </style>
    <span><content></content></span>
    <script>
      class NuiButton extends NeoElement {
        constructor() {
          super();

          this.addEventListener('click', e => {
            var detail = {};

            if (this.getAttribute('name')) {
              detail.buttonName = this.getAttribute('name');
            }

            this.dispatchEvent(new CustomEvent('nui-button-click', {bubbles: true, composed: true, detail}));
            e.stopPropagation();

            return false;
          });

          if (this.size) {
            this.style.fontSize = this.size;
          }
        }

        get size() {
          return this.getAttribute('size');
        }

        set size(newSize) {
          if (this.getAttribute('size') != newSize) {
            this.setAttribute('size', newSize);
          }

          this.style.fontSize = newSize;
        }
      }
    </script>
  </template>

  <template name="nui-delete-button">
    <style>
      nui-button {
        background: red;
      }
    </style>

    <nui-button name="delete">&#x2716;</nui-button>
  </template>

  <template name="nui-hscroller">
    <style>
      :host {
        display: block;
      }

      div {
        display: flex;
        white-space: nowrap;
        overflow-x: scroll;
      }
    </style>
    <div><content></content></div>
  </template>

  <template name="nui-cursor">
    <style>
      :host {
        width: 0;
        background-color: #333;
        display: inline-block;
      }

      :host::after {
        content: "\258F";
      }

      :host(:focus) {
        animation: blinker .7s infinite;
        outline: 0px solid transparent;
      }

      @keyframes blinker {
        50% { opacity: 0; }
      }
    </style>
    <span></span>
    <script>
      // !!!TODO!!! make block character an option: http://www.fileformat.info/info/unicode/block/block_elements/images.htm
      class NuiCursor extends NeoElement {
        connectedCallback() {
          super.connectedCallback();

          this.setAttribute('tabindex', '0');
          $(this).parents().each((i, node) => {
            if (node.hasNeoParent) {
              node.classList.add('nui-cursor');
            }
          });

          this.focus();
        }

        disconnectedCallback() {
          super.disconnectedCallback();

          $('.nui-cursor').removeClass('nui-cursor');
        }

        get range() {
          var range =  new Range();
          range.selectNode(this);
          range.collapse(true);

          return range;
        }
      }
    </script>
  </template>

  <template name="nui-anchor">
    <style>
    :host {
      display: none;
    }
    </style>
    <content></content>
    <script>
    class NuiAnchor extends NeoElement {}
    </script>
  </template>

  <template name="nui-placeholder">
    <style>
    :host {
      background-color: #FCFF94;
    }
    </style>
    <content></content>
    <script>
    class NuiPlaceholder extends NeoElement {}
    </script>
  </template>

  <template name="nui-commands">
    <style>
      :host {
        display: block;
        position: absolute;
        bottom: 2em;
        left: 2em;
        background-color: #fff;
        min-width: 12em;
        min-height: 1em;

        border-radius: .15em;

        text-align: left;

        opacity: 0;
        transition: opacity .25s ease-in-out;
      }

      :host(.active) {
        opacity: 1;
      }
    </style>
    <div>
      <div><span id="ctrlKey">&#x2303;</span><span id="altKey">&#x2325;</span><span id="metaKey">&#x2318;</span><span id="match"></span></div>
      <div id="list"</div>
    </div>
    <script>
      class NuiCommands extends PhElement {
        connectedCallback() {
          super.connectedCallback();

          var self = this;

          document.addEventListener('focusout', e => {
              self.active = false;
          });
        }

        get active() {
          return this._active;
        }

        set active(newActive) {
          this._active = newActive;
          if (this._active) {
            this.classList.add('active');
          } else {
            this.classList.remove('active');
          }
        }

        syncModifiers(pke) {
          var e = pke.originalEvent;

          ['ctrlKey', 'altKey', 'metaKey'].forEach(key => {
            this.shadowRoot.querySelector('#' + key).style.display = e[key] ? 'inline' : 'none';
          });
        }

        processCommandKeyEvent(e) {
          var pke = keyboard.processKeyEvent(e.originalEvent);

          this.syncModifiers(pke);

          if (pke.hasModifier != this.active) {
            this.active = pke.hasModifier;
          }


        }
      }
    </script>
  </template>
</ph-components>
